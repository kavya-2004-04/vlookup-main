<!DOCTYPE html>
<html lang="en">
<head>
  <script type="module">
    // Firebase App and Firestore modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    // Firebase Auth modules
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBiYs7FoNkZoCGISsbpUW_VTHJ3dLssheo",
      authDomain: "vlookup-eb2ae.firebaseapp.com",
      projectId: "vlookup-eb2ae",
      storageBucket: "vlookup-eb2ae.appspot.com",
      messagingSenderId: "41494813156",
      appId: "1:41494813156:web:6b98657c5c1469769f4ff1",
      measurementId: "G-1PBVX0QKRE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // --- Auth Guard and Session Timeout ---
    onAuthStateChanged(auth, (user) => {
      const loginTimestamp = localStorage.getItem('loginTimestamp');
      const now = new Date().getTime();
      const threeHours = 3 * 60 * 60 * 1000; // 3 hours in milliseconds

      if (user) {
        // User is signed in. Check if the session has expired.
        if (loginTimestamp && (now - loginTimestamp > threeHours)) {
          // Session expired
          alert("Your session has expired. Please log in again.");
          signOut(auth).then(() => {
            localStorage.removeItem('loginTimestamp');
            window.location.href = "../../index.html";
          });
        }
      } else {
        // No user is signed in. Redirect to login.
        window.location.href = "../../index.html";
      }
    });

    // âœ… Logout with Firebase signOut
    window.logout = async () => {
      await signOut(auth);
      localStorage.removeItem('loginTimestamp'); // Clear timestamp on logout
      window.location.href = "../../index.html";
    };

    // Expose Firestore helpers to the global scope
    window.db = db;
    window.fs = { collection, getDocs, addDoc, deleteDoc, updateDoc, doc };
  </script>

  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Admin - Post Jobs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f8f9fa;
      color: #2d3748;
      line-height: 1.6;
      padding-top: 80px; /* Account for fixed header */
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Navigation - Same as services page */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background-color: #2c3e50;
      padding: 1rem 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }
    
    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo img {
      height: 40px;
    }
    
    .navmenu {
      display: flex;
      align-items: center;
    }
    
    .navmenu ul {
      display: flex;
      list-style: none;
      gap: 15px;
      margin: 0;
      padding: 0;
      align-items: center;
    }
    
    .navmenu a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 12px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    .navmenu a:hover,
    .navmenu a.active {
      color: #3498db;
      background: rgba(255, 255, 255, 0.1);
    }
    
    .logout-btn {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s;
    }
    
    .logout-btn:hover {
      background-color: #c0392b;
    }
    
    .mobile-nav-toggle {
      display: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    /* Admin Content Styles */
    .admin-content {
      padding: 2rem 0;
    }
    
    .admin-section {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .admin-section h2 {
      color: #2c3e50;
      margin-bottom: 1.5rem;
      padding-bottom: 0.8rem;
      border-bottom: 3px solid #3498db;
      font-size: 1.8rem;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .btn {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    
    .btn:hover {
      background-color: #2980b9;
    }
    
    .btn-remove {
      background-color: #e74c3c;
    }
    
    .btn-remove:hover {
      background-color: #c0392b;
    }
    
    .btn-edit {
      background-color: #f39c12;
    }
    
    .btn-edit:hover {
      background-color: #e67e22;
    }
    
    /* Jobs List */
    .jobs-list {
      list-style: none;
    }
    
    .job-item {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: relative;
    }
    
    .job-title {
      font-size: 1.25rem;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }
    
    .job-detail {
      margin-bottom: 0.5rem;
      color: #555;
    }
    
    .job-detail strong {
      color: #2c3e50;
    }
    
    .job-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .action-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      color: white;
    }
    
    /* No jobs message */
    .no-jobs-message {
      text-align: center;
      padding: 2rem;
      color: #666;
      background: #f8f9fa;
      border-radius: 8px;
      display: none;
    }
    
    /* Edit Form Styles */
    .edit-form {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .navmenu ul {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #2c3e50;
        flex-direction: column;
        padding: 20px;
        gap: 10px;
      }
      
      .navmenu ul.show {
        display: flex;
      }
      
      .mobile-nav-toggle {
        display: block;
      }
      
      .admin-section {
        padding: 1.5rem;
      }
      
      .job-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <header class="header">
    <div class="container nav-container">
      <div class="logo">
        <a href="../../index.html"><img src="../../assets/Logo1.png" alt="VLookUp Logo" onerror="this.src='https://via.placeholder.com/150x40/2c3e50/ffffff?text=VLookUp'"></a>
      </div>
      <nav class="navmenu">
        <ul>
          <li><a href="../../index.html">Home</a></li>
          <li><a href="../../about_us.html">About</a></li>
          <li><a href="../../service.html">Services</a></li>
          <li><a href="../../career.html">Careers</a></li>
          <li><a href="../../contact_us.html">Contact</a></li>
          <li><a href="admin_career.html" class="active">Admin</a></li>
          <li><button class="logout-btn" onclick="logout()">Logout</button></li>
        </ul>
        <i class="mobile-nav-toggle fas fa-bars"></i>
      </nav>
    </div>
  </header>

  <main class="container admin-content">
    <!-- Add Job Form -->
    <section class="admin-section">
      <h2>Add Job Opening</h2>
      <form id="jobForm">
        <div class="form-group">
          <label for="title">Job Title</label>
          <input type="text" id="title" placeholder="e.g. Software Developer" required>
        </div>
        <div class="form-group">
          <label for="experience">Experience (e.g. 2-4 years)</label>
          <input type="text" id="experience" placeholder="e.g. 2-4 years" required>
        </div>
        <div class="form-group">
          <label for="skills">Skills (comma-separated)</label>
          <input type="text" id="skills" placeholder="e.g. JavaScript, React, Node.js" required>
        </div>
        <div class="form-group">
          <label for="job_description">Job Description</label>
          <textarea id="job_description" placeholder="Describe the role and responsibilities..." required></textarea>
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <input type="text" id="location" placeholder="e.g. Hyderabad" required>
        </div>
        <button type="submit" class="btn">Add Job</button>
      </form>
    </section>

    <!-- Current Jobs -->
    <section class="admin-section">
      <h2>Current Job Openings</h2>
      <p id="noJobsMessage" class="no-jobs-message">Currently, there are no jobs available.</p>
      <ul id="jobList" class="jobs-list"></ul>
    </section>
  </main>

  <script type="module">
    const jobForm = document.getElementById("jobForm");
    const jobList = document.getElementById("jobList");
    const noJobsMessage = document.getElementById("noJobsMessage");

    const { collection, getDocs, addDoc, deleteDoc, updateDoc, doc } = window.fs;
    const jobsRef = collection(window.db, "jobs");

    async function loadJobs() {
      const snapshot = await getDocs(jobsRef);
      jobList.innerHTML = "";
      if (snapshot.empty) {
        noJobsMessage.style.display = "block";
        return;
      }
      noJobsMessage.style.display = "none";

      snapshot.forEach(docSnap => {
        const job = docSnap.data();
        const li = document.createElement("li");
        li.className = "job-item";
        li.innerHTML = `
          <h3 class="job-title">${job.title}</h3>
          <p class="job-detail"><strong>Experience:</strong> ${job.experience}</p>
          <p class="job-detail"><strong>Location:</strong> ${job.location}</p>
          <p class="job-detail"><strong>Skills:</strong> ${job.skills}</p>
          <p class="job-detail"><strong>Description:</strong> ${job.job_description}</p>
          <div class="job-actions">
            <button class="action-btn btn-edit" onclick="enableEdit('${docSnap.id}', '${job.title}', '${job.experience}', '${job.skills}', '${job.job_description}', '${job.location}')">Edit</button>
            <button class="action-btn btn-remove" onclick="deleteJob('${docSnap.id}')">Delete</button>
          </div>
          <div id="edit-form-${docSnap.id}" class="edit-form">
            <h4>Edit Job</h4>
            <form onsubmit="updateJob(event, '${docSnap.id}')">
              <div class="form-group">
                <label>Job Title</label>
                <input type="text" id="edit-title-${docSnap.id}" value="${job.title}" required>
              </div>
              <div class="form-group">
                <label>Experience</label>
                <input type="text" id="edit-experience-${docSnap.id}" value="${job.experience}" required>
              </div>
              <div class="form-group">
                <label>Skills</label>
                <input type="text" id="edit-skills-${docSnap.id}" value="${job.skills}" required>
              </div>
              <div class="form-group">
                <label>Description</label>
                <textarea id="edit-description-${docSnap.id}" required>${job.job_description}</textarea>
              </div>
              <div class="form-group">
                <label>Location</label>
                <input type="text" id="edit-location-${docSnap.id}" value="${job.location}" required>
              </div>
              <div class="job-actions">
                <button type="submit" class="btn">Update Job</button>
                <button type="button" class="btn-remove" onclick="cancelEdit('${docSnap.id}')">Cancel</button>
              </div>
            </form>
          </div>
        `;
        jobList.appendChild(li);
      });
    }

    window.enableEdit = (id) => {
      document.querySelectorAll('.edit-form').forEach(form => form.style.display = 'none');
      const editForm = document.getElementById(`edit-form-${id}`);
      if (editForm) editForm.style.display = 'block';
    };

    window.cancelEdit = (id) => {
      const editForm = document.getElementById(`edit-form-${id}`);
      if (editForm) editForm.style.display = 'none';
    };

    window.updateJob = async (e, id) => {
      e.preventDefault();
      const updatedJob = {
        title: document.getElementById(`edit-title-${id}`).value,
        experience: document.getElementById(`edit-experience-${id}`).value,
        skills: document.getElementById(`edit-skills-${id}`).value,
        job_description: document.getElementById(`edit-description-${id}`).value,
        location: document.getElementById(`edit-location-${id}`).value
      };
      await updateDoc(doc(window.db, "jobs", id), updatedJob);
      document.getElementById(`edit-form-${id}`).style.display = 'none';
      loadJobs();
    };

    window.deleteJob = async (id) => {
      if (confirm("Are you sure you want to delete this job?")) {
        await deleteDoc(doc(window.db, "jobs", id));
        loadJobs();
      }
    };

    jobForm.addEventListener("submit", async e => {
      e.preventDefault();
      const job = {
        title: document.getElementById("title").value,
        experience: document.getElementById("experience").value,
        skills: document.getElementById("skills").value,
        job_description: document.getElementById("job_description").value,
        location: document.getElementById("location").value,
        postedAt: new Date().toISOString()
      };
      await addDoc(jobsRef, job);
      jobForm.reset();
      loadJobs();
    });

    document.addEventListener('DOMContentLoaded', () => {
      const mobileNavToggle = document.querySelector('.mobile-nav-toggle');
      const navMenu = document.querySelector('.navmenu ul');
      mobileNavToggle?.addEventListener('click', () => navMenu.classList.toggle('show'));
      loadJobs();
    });
  </script>
</body>
</html>